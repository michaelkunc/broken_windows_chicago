var crimeData = [
  {
    "arrest": false,
    "beat": "0513",
    "block": "003XX W 110TH ST",
    "case_number": "HY191041",
    "community_area": "49",
    "date": "2014-11-02T05:57:00.000",
    "description": "HARASSMENT BY TELEPHONE",
    "district": "005",
    "domestic": false,
    "fbi_code": "26",
    "id": "10001595",
    "iucr": "2825",
    "latitude": "41.694202189",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.631029,
        41.694202
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.631029227",
    "primary_type": "OTHER OFFENSE",
    "updated_on": "2015-03-22T16:07:18.000",
    "ward": "34",
    "x_coordinate": "1176057",
    "y_coordinate": "1831941",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "1412",
    "block": "030XX N DRAKE AVE",
    "case_number": "HY223111",
    "community_area": "21",
    "date": "2014-11-02T08:00:00.000",
    "description": "NON-AGGRAVATED",
    "district": "014",
    "domestic": true,
    "fbi_code": "02",
    "id": "10033820",
    "iucr": "0281",
    "latitude": "41.937241732",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.716254,
        41.937242
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.716254327",
    "primary_type": "CRIM SEXUAL ASSAULT",
    "updated_on": "2015-04-19T16:16:17.000",
    "ward": "35",
    "x_coordinate": "1152145",
    "y_coordinate": "1920325",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "1422",
    "block": "033XX W POTOMAC AVE",
    "case_number": "HY245282",
    "community_area": "23",
    "date": "2014-11-03T09:40:00.000",
    "description": "HARASSMENT BY ELECTRONIC MEANS",
    "district": "014",
    "domestic": true,
    "fbi_code": "26",
    "id": "10056031",
    "iucr": "2826",
    "latitude": "41.904728955",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.710818,
        41.904729
      ]
    },
    "location_description": "APARTMENT",
    "longitude": "-87.710818472",
    "primary_type": "OTHER OFFENSE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "26",
    "x_coordinate": "1153710",
    "y_coordinate": "1908488",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0825",
    "block": "061XX S WASHTENAW AVE",
    "case_number": "HY182695",
    "community_area": "66",
    "date": "2014-12-01T00:01:00.000",
    "description": "CRIMINAL SEXUAL ABUSE",
    "district": "008",
    "domestic": false,
    "fbi_code": "17",
    "id": "10056079",
    "iucr": "1563",
    "latitude": "41.782462726",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.691195,
        41.782463
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.691195037",
    "primary_type": "SEX OFFENSE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "15",
    "x_coordinate": "1159385",
    "y_coordinate": "1863974",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0112",
    "block": "0000X N STATE ST",
    "case_number": "HY242949",
    "community_area": "32",
    "date": "2014-11-11T12:00:00.000",
    "description": "CREDIT CARD FRAUD",
    "district": "001",
    "domestic": false,
    "fbi_code": "11",
    "id": "10057113",
    "iucr": "1150",
    "latitude": "41.882587116",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.628001,
        41.882587
      ]
    },
    "location_description": "DEPARTMENT STORE",
    "longitude": "-87.628000581",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "42",
    "x_coordinate": "1176321",
    "y_coordinate": "1900594",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "1611",
    "block": "072XX W COYLE AVE",
    "case_number": "HY246383",
    "community_area": "9",
    "date": "2014-12-17T12:00:00.000",
    "description": "HARASSMENT BY ELECTRONIC MEANS",
    "district": "016",
    "domestic": false,
    "fbi_code": "26",
    "id": "10057197",
    "iucr": "2826",
    "latitude": "42.007287058",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.807074,
        42.007287
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.807073582",
    "primary_type": "OTHER OFFENSE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "41",
    "x_coordinate": "1127278",
    "y_coordinate": "1945685",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "1654",
    "block": "005XX W OHARE ST",
    "case_number": "HY242019",
    "community_area": "76",
    "date": "2014-11-20T16:00:00.000",
    "description": "THEFT BY LESSEE,MOTOR VEH",
    "district": "016",
    "domestic": false,
    "fbi_code": "11",
    "id": "10057452",
    "iucr": "1206",
    "latitude": "41.980716512",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.883612,
        41.980717
      ]
    },
    "location_description": "AIRPORT VENDING ESTABLISHMENT",
    "longitude": "-87.883612088",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "41",
    "x_coordinate": "1106527",
    "y_coordinate": "1935884",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0834",
    "block": "083XX S KILPATRICK AVE",
    "case_number": "HY246795",
    "community_area": "70",
    "date": "2014-07-01T14:00:00.000",
    "description": "FRAUD OR CONFIDENCE GAME",
    "district": "008",
    "domestic": false,
    "fbi_code": "11",
    "id": "10057760",
    "iucr": "1130",
    "latitude": "41.740947479",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.739254,
        41.740947
      ]
    },
    "location_description": "OTHER",
    "longitude": "-87.739253823",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "18",
    "x_coordinate": "1146382",
    "y_coordinate": "1848752",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0832",
    "block": "067XX S CAMPBELL AVE",
    "case_number": "HY246663",
    "community_area": "66",
    "date": "2014-06-13T09:00:00.000",
    "description": "$500 AND UNDER",
    "district": "008",
    "domestic": false,
    "fbi_code": "06",
    "id": "10057791",
    "iucr": "0820",
    "latitude": "41.771102397",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.686004,
        41.771102
      ]
    },
    "location_description": "RESIDENCE-GARAGE",
    "longitude": "-87.68600384",
    "primary_type": "THEFT",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "15",
    "x_coordinate": "1160832",
    "y_coordinate": "1859845",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "2223",
    "block": "094XX S PARNELL AVE",
    "case_number": "HY247052",
    "community_area": "73",
    "date": "2014-05-10T00:00:00.000",
    "description": "BOGUS CHECK",
    "district": "022",
    "domestic": false,
    "fbi_code": "11",
    "id": "10057890",
    "iucr": "1110",
    "latitude": "41.72219144",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.637325,
        41.722191
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.637325403",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "21",
    "x_coordinate": "1174255",
    "y_coordinate": "1842126",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "1133",
    "block": "007XX S CENTRAL PARK AVE",
    "case_number": "HY247013",
    "community_area": "27",
    "date": "2014-11-04T09:00:00.000",
    "description": "FORGERY",
    "district": "011",
    "domestic": false,
    "fbi_code": "10",
    "id": "10057927",
    "iucr": "1120",
    "latitude": "41.872026114",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.71545,
        41.872026
      ]
    },
    "location_description": "OTHER",
    "longitude": "-87.71545006",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "24",
    "x_coordinate": "1152535",
    "y_coordinate": "1896562",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "1032",
    "block": "033XX S KEDZIE AVE",
    "case_number": "HY246768",
    "community_area": "30",
    "date": "2014-10-01T12:00:00.000",
    "description": "BOGUS CHECK",
    "district": "010",
    "domestic": false,
    "fbi_code": "11",
    "id": "10058019",
    "iucr": "1110",
    "latitude": "41.832025711",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.70482,
        41.832026
      ]
    },
    "location_description": "COMMERCIAL / BUSINESS OFFICE",
    "longitude": "-87.704819536",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "22",
    "x_coordinate": "1155537",
    "y_coordinate": "1882007",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0813",
    "block": "061XX S KOLIN AVE",
    "case_number": "HY247893",
    "community_area": "65",
    "date": "2014-12-08T15:00:00.000",
    "description": "FORCIBLE ENTRY",
    "district": "008",
    "domestic": false,
    "fbi_code": "05",
    "id": "10059059",
    "iucr": "0610",
    "latitude": "41.781518772",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.731246,
        41.781519
      ]
    },
    "location_description": "VACANT LOT/LAND",
    "longitude": "-87.731245904",
    "primary_type": "BURGLARY",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "13",
    "x_coordinate": "1148464",
    "y_coordinate": "1863551",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0723",
    "block": "064XX S LOWE AVE",
    "case_number": "HY247655",
    "community_area": "68",
    "date": "2014-12-25T09:00:00.000",
    "description": "$500 AND UNDER",
    "district": "007",
    "domestic": false,
    "fbi_code": "06",
    "id": "10059140",
    "iucr": "0820",
    "latitude": "41.777811266",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.640669,
        41.777811
      ]
    },
    "location_description": "APARTMENT",
    "longitude": "-87.640669209",
    "primary_type": "THEFT",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "16",
    "x_coordinate": "1173179",
    "y_coordinate": "1862386",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0925",
    "block": "003XX W 42ND PL",
    "case_number": "HY248338",
    "community_area": "37",
    "date": "2014-11-05T10:00:00.000",
    "description": "FINANCIAL IDENTITY THEFT OVER $ 300",
    "district": "009",
    "domestic": false,
    "fbi_code": "11",
    "id": "10059573",
    "iucr": "1153",
    "latitude": "41.817378504",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.634806,
        41.817379
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.634806284",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "3",
    "x_coordinate": "1174661",
    "y_coordinate": "1876817",
    "year": "2014"
  },
  {
    "arrest": false,
    "beat": "0622",
    "block": "005XX W 81ST ST",
    "case_number": "HY248413",
    "community_area": "44",
    "date": "2014-09-15T00:00:00.000",
    "description": "FINAN EXPLOIT-ELDERLY/DISABLED",
    "district": "006",
    "domestic": true,
    "fbi_code": "11",
    "id": "10059703",
    "iucr": "1195",
    "latitude": "41.746979123",
    "location": {
      "type": "Point",
      "coordinates": [
        -87.637047,
        41.746979
      ]
    },
    "location_description": "RESIDENCE",
    "longitude": "-87.637046742",
    "primary_type": "DECEPTIVE PRACTICE",
    "updated_on": "2015-05-11T12:38:40.000",
    "ward": "21",
    "x_coordinate": "1174258",
    "y_coordinate": "1851159",
    "year": "2014"
  }
];

var serviceData = [
  {
    "service_request_id": "14-00684314",
    "status": "closed",
    "status_notes": "CDOT Inspect Public Way Survey Transfer Outcome",
    "service_name": "Pothole in Street",
    "service_code": "4fd3b656e750846c53000004",
    "agency_responsible": "Division of In-House Construction CDOT",
    "requested_datetime": "2014-05-09T19:02:21-05:00",
    "updated_datetime": "2015-10-10T10:15:40-05:00",
    "address": "1200 W 81ST ST, CHICAGO, IL, 60620",
    "lat": 41.74685764200721,
    "long": -87.6536401592609,
    "attributes": {
      "WHEREIST": "TRAFFIC"
    },
    "extended_attributes": {
      "channel": "phone",
      "police": "6",
      "zip": "60620",
      "ward": "21"
    },
    "notes": [
      {
        "datetime": "2014-05-09T19:02:21-05:00",
        "summary": "Request opened",
        "type": "opened"
      },
      {
        "datetime": "2014-07-29T14:11:00-05:00",
        "summary": "Final Outcome",
        "description": "CDOT Inspect Public Way Survey Transfer Outcome",
        "type": "activity"
      },
      {
        "datetime": "2014-07-29T14:11:58-05:00",
        "summary": "Follow-on Inspect Public Way Construction Created",
        "description": "Inspect Public Way Survey #14-01225670 created for Transportation",
        "type": "follow_on_created",
        "extended_attributes": {
          "service_request_id": "14-01225670",
          "service_name": "Inspect Public Way Survey",
          "agency_responsible": "Transportation"
        }
      },
      {
        "datetime": "2014-07-30T15:18:47-05:00",
        "summary": "Follow-on CDOT Recommended Restoration Created",
        "description": "CDOT Recommended Restoration #14-01235584 created for Water Management",
        "type": "follow_on_created",
        "extended_attributes": {
          "service_request_id": "14-01235584",
          "service_name": "CDOT Recommended Restoration",
          "agency_responsible": "Water Management"
        }
      },
      {
        "datetime": "2014-07-30T15:18:48-05:00",
        "summary": "Follow-on Inspect Public Way Construction Closed",
        "description": "Inspect Public Way Survey #14-01225670 closed by Transportation",
        "type": "follow_on_closed",
        "extended_attributes": {
          "service_request_id": "14-01225670",
          "service_name": "Inspect Public Way Survey",
          "agency_responsible": "Transportation"
        }
      },
      {
        "datetime": "2015-10-10T10:15:39-05:00",
        "summary": "Follow-on CDOT Recommended Restoration Closed",
        "description": "CDOT Recommended Restoration #14-01235584 closed by Water Management",
        "type": "follow_on_closed",
        "extended_attributes": {
          "service_request_id": "14-01235584",
          "service_name": "CDOT Recommended Restoration",
          "agency_responsible": "Water Management"
        }
      },
      {
        "datetime": "2015-10-10T10:15:40-05:00",
        "summary": "Request closed",
        "type": "closed"
      }
    ]
  }
  ];
// HEAT MAP
var map, heatmap;

function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: {
            lat: 41.8914,
            lng: -87.666
        },
        mapTypeId: google.maps.MapTypeId.MAP
    });

    heatmap = new google.maps.visualization.HeatmapLayer({
        data: getPoints(),
        map: map
    });
}

function toggleHeatmap() {
    heatmap.setMap(heatmap.getMap() ? null : map);
}

function changeGradient() {
    var gradient = [
        'rgba(0, 255, 255, 0)',
        'rgba(0, 255, 255, 1)',
        'rgba(0, 191, 255, 1)',
        'rgba(0, 127, 255, 1)',
        'rgba(0, 63, 255, 1)',
        'rgba(0, 0, 255, 1)',
        'rgba(0, 0, 223, 1)',
        'rgba(0, 0, 191, 1)',
        'rgba(0, 0, 159, 1)',
        'rgba(0, 0, 127, 1)',
        'rgba(63, 0, 91, 1)',
        'rgba(127, 0, 63, 1)',
        'rgba(191, 0, 31, 1)',
        'rgba(255, 0, 0, 1)'
    ];
    heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

function changeRadius() {
    heatmap.set('radius', heatmap.get('radius') ? null : 20);
}

function changeOpacity() {
    heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
}

// my stuff
var coordinates = [];

// crime data point collection
for (var i = 0; i < crimeData.length; i++) {
    if ((crimeData[i].hasOwnProperty('latitude')) && (crimeData[i].hasOwnProperty('longitude'))) {
        coordinates.push([crimeData[i].latitude, crimeData[i].longitude]);
    }
}

//service datapoint collection
for (var i = 0; i < serviceData.length; i++) {
    if ((serviceData[i].hasOwnProperty('lat')) && (serviceData[i].hasOwnProperty('long'))) {
        serviceData[i]['longitude'] = serviceData[i]['long'];
        delete serviceData[i]['long'];
        serviceData[i]['latitude'] = serviceData[i]['lat'];
        delete serviceData[i]['lat'];
        coordinates.push([serviceData[i].latitude, serviceData[i].longitude]);
    }
}

function getPoints() {
    var points = [];
    for (var i = 0; i < coordinates.length; i++) {
        points.push(new google.maps.LatLng(coordinates[i][0], coordinates[i][1]));
    }
    return points;

}

// Crime Type Bar Chart

var container = {};

for (var i = 0; i < crimeData.length; i ++ ){
  var num = crimeData[i].primary_type;
  container[num] = container[num] ? container[num] + 1 : 1;
}

var crimeCounts = [];
// sorts the crime counts descending
for (var crime in container){
  crimeCounts.push([crime, container[crime]]);
  crimeCounts.sort(function(a,b) {return b[1] - a[1]});
};

var data = [
  {
    x: [crimeCounts[0][0], crimeCounts[1][0], crimeCounts[2][0], crimeCounts[3][0], crimeCounts[4][0], crimeCounts[5][0]],
    y: [crimeCounts[0][1], crimeCounts[1][1], crimeCounts[2][1], crimeCounts[3][1], crimeCounts[4][1], crimeCounts[5][1]],
    type: 'bar'
  }
];

Plotly.newPlot('crime_type_bar_chart', data);